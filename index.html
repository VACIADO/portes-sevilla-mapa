<!-- COMIENZO DEL ARCHIVO HTML -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Portes, Mudanzas y Vaciados en Sevilla</title>
  <style>
    /* ... Estilos que ya tienes (sin cambios) ... */
    /* (omitidos aqu칤 por espacio, pero todos tus estilos permanecen igual) */
    #map {
      height: 350px;
      width: 100%;
      border-radius: 8px;
      margin-bottom: 15px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>游뚴 Portes, Mudanzas y Vaciados en Sevilla</h1>
    <p style="text-align: center; font-size: 18px;">
      Servicio r치pido, profesional y econ칩mico en Sevilla y alrededores. Ll치manos o escr칤benos por WhatsApp para presupuesto inmediato.
    </p>

    <!-- ... Servicios y Tarifas omitidos (sin cambios) ... -->

    <h2>游눫 Calcula tu presupuesto</h2>
    <div style="border: 1px solid #ccc; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
      <div id="map"></div>

      <label for="nombre">Nombre completo:</label>
      <input type="text" id="nombre" placeholder="Tu nombre" />

      <label for="telefono">N칰mero WhatsApp:</label>
      <input type="tel" id="telefono" placeholder="Ej: tu numero" />

      <!-- Opciones de servicio -->
      <!-- ... (sin cambios) ... -->

      <label for="origen">Direcci칩n origen:</label>
      <input type="text" id="origen" placeholder="Selecciona en el mapa" readonly />

      <label for="destino">Direcci칩n destino:</label>
      <input type="text" id="destino" placeholder="Selecciona en el mapa" readonly />

      <label for="kilometros">Distancia estimada (kms):</label>
      <input type="text" id="kilometros" placeholder="Se calcula autom치ticamente" readonly />

      <label for="notas">Notas adicionales:</label>
      <textarea id="notas" placeholder="Ej: Es una mudanza con cajas, sof치 y nevera. Hay ascensor."></textarea>

      <button onclick="enviarSolicitud()">Solicitar Presupuesto</button>

      <p id="resultado"></p>
      <p style="text-align:center;">游눫 Te mandamos el presupuesto por WhatsApp</p>
    </div>

    <!-- Contacto -->
    <!-- ... (sin cambios) ... -->
  </div>

  <!-- Scripts -->
  <script>
    // Mapa interactivo con Google Maps
    let map, geocoder, directionsService;
    let markerCount = 0;
    let origenLatLng, destinoLatLng;

    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 37.3826, lng: -5.9963 },
        zoom: 10,
      });

      geocoder = new google.maps.Geocoder();
      directionsService = new google.maps.DirectionsService();

      map.addListener("click", (e) => {
        if (markerCount === 0) {
          origenLatLng = e.latLng;
          geocodeLatLng(origenLatLng, "origen");
          markerCount++;
        } else {
          destinoLatLng = e.latLng;
          geocodeLatLng(destinoLatLng, "destino");
          calcularDistancia(origenLatLng, destinoLatLng);
          markerCount = 0;
        }
      });
    }

    function geocodeLatLng(latlng, campo) {
      geocoder.geocode({ location: latlng }, (results, status) => {
        if (status === "OK" && results[0]) {
          document.getElementById(campo).value = results[0].formatted_address;
        }
      });
    }

    function calcularDistancia(origen, destino) {
      directionsService.route(
        {
          origin: origen,
          destination: destino,
          travelMode: google.maps.TravelMode.DRIVING,
        },
        (response, status) => {
          if (status === "OK") {
            const distanciaTexto = response.routes[0].legs[0].distance.text;
            document.getElementById("kilometros").value = distanciaTexto;
            alert("Distancia: " + distanciaTexto);
          }
        }
      );
    }

    function enviarSolicitud() {
      const nombre = document.getElementById('nombre').value.trim();
      const telefono = document.getElementById('telefono').value.trim();
      const origen = document.getElementById('origen').value.trim();
      const destino = document.getElementById('destino').value.trim();
      const distancia = document.getElementById('kilometros').value.trim();
      const notas = document.getElementById('notas').value.trim();

      const opciones = document.querySelectorAll('.option');
      let seleccionadas = [];
      opciones.forEach(op => {
        if (op.checked) {
          seleccionadas.push(op.dataset.name);
        }
      });

      const serviciosTexto = seleccionadas.join(', ');

      const mensajeWhats = `Hola, soy ${nombre}.
Solicito presupuesto para:
Servicios: ${serviciosTexto}
Direcci칩n origen: ${origen}
Direcci칩n destino: ${destino}
Distancia estimada: ${distancia}
Notas: ${notas}
N칰mero de contacto: ${telefono}`;

      const numeroWhatsApp = '34698373471';
      window.open(`https://wa.me/${numeroWhatsApp}?text=${encodeURIComponent(mensajeWhats)}`, '_blank');

      fetch('https://formspree.io/f/mwpqwvlr', {
        method: 'POST',
        headers: {
          'Accept': 'application/json',
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          nombre,
          telefono,
          servicios: serviciosTexto,
          origen,
          destino,
          distancia,
          notas
        })
      })
      .then(response => {
        if (response.ok) {
          document.getElementById('resultado').textContent = 'Solicitud enviada correctamente.';
        } else {
          document.getElementById('resultado').textContent = 'Error al enviar. WhatsApp s칤 se ha abierto.';
        }
      })
      .catch(() => {
        document.getElementById('resultado').textContent = 'Error enviando email, pero WhatsApp se ha abierto.';
      });
    }
  </script>

  <!-- Google Maps API -->
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDVPHqQDXL4vVijvq2vg3KeGKwgR-VDgu8&callback=initMap">
  </script>
</body>
</html>
<!-- FIN DEL ARCHIVO HTML -->
